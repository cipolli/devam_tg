md-dialog.funcionalidade-dialog(aria-label='Funcionalidade')
  md-toolbar.md-toolbar-tools
    h2 Tarefas
    md-button.md-icon-button(ng-click='closeModalCadastroFuncionalidade()')
      md-icon &times

  md-dialog-content(layout='row')
    div.funcionalidade
      div.container
        form(name='formFuncionalidade')
          div.formulario
            div.inputContainer
              label.label(for='nome') Nome
              input.input(type='text',
                          name='nome',
                          data-ng-model='novaFuncionalidade.titulo',
                          ng-disabled='novaFuncionalidade.status.codigo === 10',
                          required)
            
            md-input-container.md-block(flex-gt-sm='95')
              label Funcionalidade
              md-select(ng-model='novaFuncionalidade.funcionalidade' ng-model-options="{trackBy: '$value._id'}" required name='tarefaFuncionalidade'
                ng-change="converterData(novaFuncionalidade.funcionalidade)", ng-disabled='novaFuncionalidade.status.codigo === 10')
                md-option(ng-repeat='tarefaFuncionalidade in tarefaFuncionalidades track by tarefaFuncionalidade._id', ng-value='tarefaFuncionalidade')
                  | {{tarefaFuncionalidade.titulo}}

            div.inputContainer
              label.label(for='editor') Especificação geral
              textarea(type="text"
                      name='descricao',
                      rows='5',
                      ng-disabled='novaFuncionalidade.status.codigo === 10',
                      data-ng-model='novaFuncionalidade.descricao')

            div.botoes
            
            div.anexos

            div.comentarios(ng-if='edicao')
              div.header
                i.material-icons.md-24 speaker_notes
                span Comentário
              div.inputContainer
                textarea(type="text"
                        rows='5'
                        data-ng-model='comentario.mensagem')
              div.botoes
                md-button.md-raised.md-primary(data-ng-click='adicionarComentario(comentario, novaFuncionalidade)') Adicionar
            
            div.historico(ng-if='edicao')
              div.header
                i.material-icons.md-24 subject 
                span Historico
              ul.list
                li.item(data-ng-repeat="historico in historicos | orderBy:'data':true")
                  div.acao
                    span(data-ng-bind='historico.acao')
                  div.descricao(data-ng-bind='historico.descricao')
                  div.data
                    span {{(historico.data | date:'dd/MM/yyyy HH:mm')}}
                  div.divider
             


          div.opcoes
            div
            md-input-container.data(flex-gt-sm='')
              label Data início
              md-datepicker(ng-model='novaFuncionalidade.dataInicio',  
                md-min-date='novaFuncionalidade.funcionalidade.dataInicio',
                md-max-date='novaFuncionalidade.funcionalidade.dataFim',
                required='{{novaFuncionalidade.dataFim}}', ng-disabled='novaFuncionalidade.status.codigo === 10 || !novaFuncionalidade.funcionalidade')
            
            md-input-container.data(flex-gt-sm='')
              label Data fim
              md-datepicker(ng-model='novaFuncionalidade.dataFim', 
                md-min-date='novaFuncionalidade.dataInicio'
                md-max-date='novaFuncionalidade.funcionalidade.dataFim', 
                ng-disabled='novaFuncionalidade.status.codigo === 10 || !novaFuncionalidade.dataInicio')

            div.left15
              md-input-container.margindown(flex-gt-sm="")
                label Duração (Horas)
                input(name="duracao", ng-model="novaFuncionalidade.duracao" ng-pattern="/^[0-9]{2}|[0-9]{1}$/", ng-disabled='novaFuncionalidade.status.codigo === 10')

            div.left15(ng-controller='UsuarioSearchController as mv')
              md-input-container(flex-gt-sm="")
                md-contact-chips(ng-model='novaFuncionalidade.usuarios', 
                  md-contacts='mv.querySearch($query)', 
                  md-contact-name='nome', 
                  md-contact-image='mock.imagem', 
                  md-contact-email='email', 
                  md-require-match='true', 
                  md-highlight-flags='i', 
                  ng-disabled='novaFuncionalidade.status.codigo === 10',
                  filter-selected='mv.filterSelected', 
                  placeholder='Usuários')
            
            div.left15(data-ng-controller='TagController')
              md-input-container.margindown.fullsize
                label Tags
                md-select(ng-model="novaFuncionalidade.tags" md-on-close="clearSearchTerm()" data-md-container-class="selectdemoSelectHeader" multiple="true"
                  ng-model-options="{trackBy: '$value._id'}", ng-disabled='novaFuncionalidade.status.codigo === 10')
                  md-select-header.demo-select-header
                    input.demo-header-searchbox.md-text(ng-model="searchTerm" type="search" placeholder="Pesquisar uma tag", ng-disabled='novaFuncionalidade.status.codigo === 10')
                  md-optgroup(label="tags")
                    md-option(ng-value="tag" ng-repeat="tag in tagsParaSelecao | filter:searchTerm", ng-style='{color: tag.cor}')
                      span(ng-style='{color: tag.cor}') {{tag.nome}}
            
            div.left15.containerstatus
              div.label
                span Status
              span.status(data-ng-bind="novaFuncionalidade.status.display")
            
            div.github(ng-if='edicao && projetoKanbanSelecionado.github && !novaFuncionalidade.numeroIssue')
              md-button.md-primary(ng-click="syncGitHub(novaFuncionalidade)") Sync Github
            
            div.github(ng-if='edicao && novaFuncionalidade.numeroIssue')
              md-input-container.data(flex-gt-sm='')
              label Github issue {{novaFuncionalidade.numeroIssue}}

            
  md-dialog-actions(layout='row')
    md-button(ng-click="closeModalCadastroFuncionalidade()")
      | Cancelar
    md-button.md-primary(ng-if='!edicao' data-ng-click='cadastrarParaSecao(novaFuncionalidade) && closeModalCadastroFuncionalidade()', data-ng-disabled='formFuncionalidade.$invalid') Salvar
    md-button.md-primary(ng-if='edicao' data-ng-click='alterarFuncionalidade(novaFuncionalidade) && closeModalCadastroFuncionalidade()', data-ng-disabled='formFuncionalidade.$invalid') Alterar